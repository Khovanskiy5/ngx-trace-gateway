# Включаем gzip-сжатие HTTP-ответов.
# Это позволяет уменьшить объём передаваемых данных (особенно для текстовых форматов)
# и снизить потребление канала, что важно при высоком RPS. Нагрузка немного смещается на CPU,
# поэтому gzip имеет смысл включать для текстового контента, а не для изображений/видео.
gzip on;

# Уровень сжатия gzip (от 1 до 9).
# Чем выше число, тем сильнее сжатие, но тем больше CPU-времени тратится на обработку.
# Уровень 5 — практичный компромисс: даёт хороший выигрыш по размеру без чрезмерного расхода CPU.
gzip_comp_level 5;

# Минимальный размер ответа (в байтах), при котором включается gzip.
# Нет смысла сжимать очень маленькие ответы: накладные расходы на компрессию
# и заголовки могут оказаться больше выигрыша. 1024 байта — типичное разумное значение.
gzip_min_length 1024;

# Добавлять заголовок Vary: Accept-Encoding.
# Это важно для кэширования (CDN, прокси, браузеры): они понимают, что ответ зависит
# от того, поддерживает ли клиент gzip, и могут хранить разные версии для разных клиентов.
gzip_vary on;

# Разрешать gzip-сжатие для запросов, пришедших через промежуточные прокси.
# Значение any говорит, что можно сжимать ответы даже если запрос уже прошёл через один или
# несколько прокси-серверов (по сути, не ограничивать по типу прокси).
gzip_proxied any;

# Перечень MIME-типов, для которых включается gzip-сжатие.
# По умолчанию сжимаются только text/html, поэтому тут расширяем список:
# - текст (plain, css)
# - JSON (application/json)
# - JS (application/javascript, text/javascript)
# - XML и RSS (application/xml, application/xml+rss)
# Бинарный контент (изображения, видео, архивы) сюда включать не нужно — они уже сжаты.
gzip_types
    text/plain
    text/css
    application/json
    application/javascript
    application/xml+rss
    application/xml
    text/javascript;