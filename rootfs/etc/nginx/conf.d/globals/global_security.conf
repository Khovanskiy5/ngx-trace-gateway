##
# GLOBAL SECURITY — общие безопасные настройки для всех виртуальных хостов
# Этот файл подключается в контексте http { ... } чтобы применяться ко всем server { }.
##

# Базовые security-заголовки, которые безопасны и полезны практически для любого HTTP-сервиса.

# Не показывать версию Nginx в заголовке Server.
# Уменьшает объём информации для потенциального атакующего.
server_tokens off;

# X-Content-Type-Options: nosniff
# Запрещает браузеру гадать тип контента (MIME-sniffing).
add_header X-Content-Type-Options "nosniff" always;

# X-Frame-Options: SAMEORIGIN
# Запрещает встраивание вашего сайта в iframe с чужих доменов.
add_header X-Frame-Options "SAMEORIGIN" always;

# X-XSS-Protection: 1; mode=block
# Включает защиту в старых браузерах (IE/старый Edge); современные браузеры полагаются на CSP.
add_header X-XSS-Protection "1; mode=block" always;

# Referrer-Policy: no-referrer
# Не отправлять Referer или отправлять минимально необходимый; строгий вариант.
add_header Referrer-Policy "no-referrer" always;

# Permissions-Policy (ранее Feature-Policy)
# Ограничивает доступ к чувствительным API. По умолчанию запрещено.
add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;

# Strict-Transport-Security (HSTS)
# Включайте глобально только если все домены по HTTPS; иначе риск потерять доступ к HTTP.
# max-age задаёт период хранения политики.
add_header Strict-Transport-Security "max-age=31536000" always;

# Включение дополнительных опций HSTS можно выполнять по необходимости
# add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# Дополнительные заголовки для старых браузеров/кейсов
add_header X-Download-Options "noopen" always;
add_header X-Permitted-Cross-Domain-Policies "none" always;
